<!DOCTYPE html>
<html>
<head>
    <title>测试删除历史任务功能</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-btn { 
            background: #ef4444; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 10px;
        }
        .test-btn:hover { background: #dc2626; }
        .log { 
            background: #f5f5f5; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
            padding: 10px; 
            margin: 10px 0; 
            font-family: monospace; 
        }
    </style>
</head>
<body>
    <h1>🧪 删除历史任务功能测试</h1>
    
    <p>这个页面用于测试 <code>showCustomConfirm</code> 函数是否正确实现。</p>
    
    <button class="test-btn" onclick="testShowCustomConfirm()">测试 showCustomConfirm 函数</button>
    <button class="test-btn" onclick="testDeleteHistoryTask()">测试删除历史任务对话框</button>
    
    <div id="log" class="log">
        <div>📋 测试日志：</div>
    </div>

    <script>
        // 模拟 showCustomConfirm 函数（复制自主应用）
        function showCustomConfirm(title, message, confirmText = '确认', cancelText = '取消') {
            return new Promise((resolve) => {
                // 创建模态框元素
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                    background: rgba(0,0,0,0.7); backdrop-filter: blur(4px);
                    z-index: 9999; display: flex; align-items: center; justify-content: center;
                `;
                
                modal.innerHTML = `
                    <div style="
                        background: white; border-radius: 16px; padding: 24px; max-width: 400px; width: 90%;
                        box-shadow: 0 20px 40px rgba(0,0,0,0.3); text-align: center;
                    ">
                        <div style="font-size: 48px; margin-bottom: 16px;">⚠️</div>
                        <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px; color: #333;">${title}</div>
                        <div style="font-size: 14px; color: #666; margin-bottom: 24px; line-height: 1.5; white-space: pre-line;">${message}</div>
                        <div style="display: flex; gap: 12px; justify-content: center;">
                            <button id="cancelBtn" style="
                                padding: 10px 20px; border-radius: 8px; border: 1px solid #ddd;
                                background: #f5f5f5; color: #333; cursor: pointer; min-width: 80px;
                            ">${cancelText}</button>
                            <button id="confirmBtn" style="
                                padding: 10px 20px; border-radius: 8px; border: none;
                                background: #ef4444; color: white; cursor: pointer; min-width: 80px;
                            ">${confirmText}</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                const confirmBtn = modal.querySelector('#confirmBtn');
                const cancelBtn = modal.querySelector('#cancelBtn');
                
                confirmBtn.onclick = () => {
                    document.body.removeChild(modal);
                    resolve(true);
                };
                
                cancelBtn.onclick = () => {
                    document.body.removeChild(modal);
                    resolve(false);
                };
                
                // ESC键支持
                const handleEscape = (event) => {
                    if (event.key === 'Escape') {
                        document.removeEventListener('keydown', handleEscape);
                        document.body.removeChild(modal);
                        resolve(false);
                    }
                };
                
                document.addEventListener('keydown', handleEscape);
            });
        }

        function log(message) {
            const logEl = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logEl.innerHTML += `<div>[${time}] ${message}</div>`;
        }

        async function testShowCustomConfirm() {
            log('🔄 开始测试 showCustomConfirm 函数...');
            
            try {
                const result = await showCustomConfirm(
                    '测试确认',
                    '这是一个测试确认对话框。\n\n请选择你的操作：\n• 点击"确定"返回 true\n• 点击"取消"返回 false\n• 按ESC键返回 false',
                    '确定',
                    '取消'
                );
                
                log(`✅ showCustomConfirm 返回结果: ${result}`);
                
                if (typeof result === 'boolean') {
                    log('✅ 函数正常工作，返回类型正确');
                } else {
                    log('❌ 函数返回类型错误');
                }
                
            } catch (error) {
                log(`❌ 测试失败: ${error.message}`);
            }
        }

        async function testDeleteHistoryTask() {
            log('🔄 测试删除历史任务对话框...');
            
            try {
                const confirmed = await showCustomConfirm(
                    '删除历史任务',
                    `确定要删除这个历史任务吗？\n\n这将删除：\n• 任务记录\n• 相关的所有图片文件\n• 相关的视频文件\n\n此操作不可恢复！`,
                    '删除',
                    '取消'
                );
                
                if (confirmed) {
                    log('✅ 用户确认删除 - 在真实应用中会执行删除操作');
                } else {
                    log('ℹ️ 用户取消删除操作');
                }
                
            } catch (error) {
                log(`❌ 测试失败: ${error.message}`);
            }
        }

        log('🚀 测试页面已加载，可以开始测试');
    </script>
</body>
</html>